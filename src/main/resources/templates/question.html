<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/js/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
    <script src="/js/bootstrap.min.js" type="application/javascript"></script>
    <link rel="stylesheet" href="/css/community.css">
</head>
<body style="background-color: #dddddd">
<div th:insert="~{navigation::nav}"></div>
<div class="container-fluid main">
    <div class="row">
        <div class="col-lg-9 col-md-12 col-sm-12">
            <h2>
                <span th:text="${questionData.question.getTitle()}"></span>
            </h2>
            <span style="color: #999999" class="text-desc">
                <img class="media-object img-rounded"  style="margin-right: 10px;display:inline;height: 30px;width: 30px" th:src="${questionData.user.getAvatarUrl()}">
                <span th:text="${questionData.user.getName()}"></span> |
                发布时间: <span th:text="${#dates.format(questionData.question.getGmtCreate(),'yyyy-MM-dd HH:mm:ss')}"></span> |
                浏览量: <span th:text="${questionData.question.getViewCount()}"></span>
            </span>
            <hr>
            <div style="min-height: 120px" class="text-desc">
                <span th:text="${questionData.question.getDescription()}"></span>
            </div>
            <hr>
            <div style="height: 30px;text-align: right" class="text-desc">
                <span><span class="glyphicon glyphicon-edit"></span><a href="#">发表评论</a></span>
                <span th:if="${session.user!=null&&session.user.getId()==questionData.question.getCreator()}">
                    <span class="glyphicon glyphicon-pencil"></span>
                    <a   th:href="${'/publish/'+questionData.question.getId()}">编辑</a>
                </span>
            </div>
            <div>
                <ul class="nav nav-tabs">
                    <li style="padding-top: 5px;padding-right:20px;"><span style="font-size: 20px;font-weight: bold" th:text="${'共'+questionData.question.getCommentCount()+'条回复'}"></span></li>
                    <li role="presentation" id="byLike" onclick="setOrderBy(2)" class="active"><a>热门回复</a></li>
                    <li role="presentation" id="byTime" onclick="setOrderBy(1)"><a>最新回复</a></li>
                </ul>
                <div>
                    <ul class="media-list" id="comment">

                    </ul>
                </div>
            </div>

            <div>
                <hr>
                <form id="form-publish">
                    <div class="form-group">
                        <textarea name="content" id="content" class="form-control" cols="30" rows="10"></textarea>
                    </div>
                    <button type="button" class="btn btn-default btn-publish" onclick="publish(1,null,null)">点击发表</button>
                </form>
            </div>
        </div>
        <div class="col-lg-3 col-md-12 col-sm-12">
            <h3><span style="margin: 0px 10px;" class="glyphicon glyphicon-duplicate" aria-hidden="true"></span>相关话题</h3>
        </div>

    </div>
</div>
</body>
<script th:inline="text">
    $.load(getReply(1,null,1,2));

    var becommentatorId=null;

    function setOrderBy(type) {
        getReply(1,null,1,type);
        if(type==1){
            $("#byLike").removeClass("active");
            $("#byTime").addClass("active");
        }

        if(type==2){
            $("#byTime").removeClass("active");
            $("#byLike").addClass("active");
        }
    }

    function setBecommentator(becommentator,obj){
        var name=$(obj).attr("data-name");
        $(".reply-text").attr("placeholder","回复 "+name);
        becommentatorId=becommentator;
    }

    function getReply(type,parentId,pageNum,orderBy) {
        becommentatorId=null;
        var box="#comment";
        if (type==1) {
            parentId=[[${questionData.question.id}]];
        }
        if (type==2) {
            box=box+parentId;
        }
        $.ajax({
            url: '/reply',
            type: 'post',
            dataType: 'text',
            data:{"parentId":parentId,"type":type,"pageNum":pageNum,"orderBy":orderBy},
            success: function (data) {
                $(box).empty();
                $(box).append(data);
            }
        });
    }


    function publish(type,parentId,obj){
        var content;
        var becommentator;

        if (type==1) {
            parentId=[[${questionData.question.id}]];
            content=$("#content").val();
        }
        if(type==2){
            content=$(obj).parent().prev().val();
        }
        if(becommentatorId!=null)
        {
            becommentator=becommentatorId;
        }


        $.ajax(
            {
                type: "POST",
                dataType: "json",
                url: "/doComment",
                data:{"content": content,"parentId":parentId,"type":type,"becommentator":becommentator},
                success: function (data){
                    if(data.code==1){
                        alert("发表成功!");
                        location.reload();
                    }
                    if(data.code==0){
                        alert(data.msg);
                    }
                }
            }
        );
    }



</script>
</html>